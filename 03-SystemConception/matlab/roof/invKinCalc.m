z(1,1)=cos(q1)*sin(q2)*sin(q3)*sin(q4)*sin(q5) - cos(q1)*cos(q2)*cos(q5)*sin(q3) - cos(q1)*cos(q3)*cos(q5)*sin(q2) - cos(q1)*cos(q2)*cos(q3)*sin(q4)*sin(q5) - cos(q4)*sin(q1)*sin(q5);
z(2,1)=cos(q1)*cos(q4)*sin(q5) - cos(q2)*cos(q5)*sin(q1)*sin(q3) - cos(q3)*cos(q5)*sin(q1)*sin(q2) - cos(q2)*cos(q3)*sin(q1)*sin(q4)*sin(q5) + sin(q1)*sin(q2)*sin(q3)*sin(q4)*sin(q5);
z(3,1)=cos(q5)*sin(q2)*sin(q3) - cos(q2)*cos(q3)*cos(q5) + cos(q2)*sin(q3)*sin(q4)*sin(q5) + cos(q3)*sin(q2)*sin(q4)*sin(q5);
zAlpha=atan2(z(2),z(1));
zBeta=atan2(z(3)*cos(zAlpha),z(1));
da17=((cos(q2)*sin(q3)*sin(zBeta) + cos(q3)*sin(q2)*sin(zBeta) - cos(q1)*cos(q2)*cos(q3)*cos(zAlpha)*cos(zBeta) + cos(q1)*cos(zAlpha)*cos(zBeta)*sin(q2)*sin(q3) - cos(q2)*cos(q3)*cos(zBeta)*sin(q1)*sin(zAlpha) + cos(zBeta)*sin(q1)*sin(q2)*sin(q3)*sin(zAlpha))*(cos(q1)*cos(q2)^2*sin(zBeta) + cos(q1)*cos(q3)^2*sin(zBeta) - 2*cos(q1)*cos(q2)^2*cos(q3)^2*sin(zBeta) + cos(q2)*cos(zAlpha)*cos(zBeta)*sin(q2) + cos(q3)*cos(zAlpha)*cos(zBeta)*sin(q3) - 2*cos(q2)*cos(q3)^2*cos(zAlpha)*cos(zBeta)*sin(q2) - 2*cos(q2)^2*cos(q3)*cos(zAlpha)*cos(zBeta)*sin(q3) + 2*cos(q1)*cos(q2)*cos(q3)*sin(q2)*sin(q3)*sin(zBeta))*(dq2*cos(q1)*cos(q2)*cos(q3)*sin(zBeta) + dq3*cos(q1)*cos(q2)*cos(q3)*sin(zBeta) + dzBeta*cos(q1)*cos(q2)*cos(zBeta)*sin(q3) + dzBeta*cos(q1)*cos(q3)*cos(zBeta)*sin(q2) + dq2*cos(q2)*cos(zAlpha)*cos(zBeta)*sin(q3) + dq2*cos(q3)*cos(zAlpha)*cos(zBeta)*sin(q2) + dq3*cos(q2)*cos(zAlpha)*cos(zBeta)*sin(q3) + dq3*cos(q3)*cos(zAlpha)*cos(zBeta)*sin(q2) + dzAlpha*cos(q2)*cos(q3)*cos(zBeta)*sin(zAlpha) + dzBeta*cos(q2)*cos(q3)*cos(zAlpha)*sin(zBeta) - dq1*cos(q2)*sin(q1)*sin(q3)*sin(zBeta) - dq1*cos(q3)*sin(q1)*sin(q2)*sin(zBeta) - dq2*cos(q1)*sin(q2)*sin(q3)*sin(zBeta) - dq3*cos(q1)*sin(q2)*sin(q3)*sin(zBeta) - dzAlpha*cos(zBeta)*sin(q2)*sin(q3)*sin(zAlpha) - dzBeta*cos(zAlpha)*sin(q2)*sin(q3)*sin(zBeta)))/(sin(q1 - zAlpha)*sin(q2 + q3)*cos(zBeta)*(cos(q1)*cos(q2)*sin(q3)*sin(zBeta) - cos(q2)*cos(q3)*cos(zAlpha)*cos(zBeta) + cos(q1)*cos(q3)*sin(q2)*sin(zBeta) + cos(zAlpha)*cos(zBeta)*sin(q2)*sin(q3))^2) - ((cos(q2)*sin(q3)*sin(zBeta) + cos(q3)*sin(q2)*sin(zBeta) - cos(q1)*cos(q2)*cos(q3)*cos(zAlpha)*cos(zBeta) + cos(q1)*cos(zAlpha)*cos(zBeta)*sin(q2)*sin(q3) - cos(q2)*cos(q3)*cos(zBeta)*sin(q1)*sin(zAlpha) + cos(zBeta)*sin(q1)*sin(q2)*sin(q3)*sin(zAlpha))*(dzBeta*cos(q1)*cos(q2)^2*cos(zBeta) + dzBeta*cos(q1)*cos(q3)^2*cos(zBeta) + dq2*cos(q2)^2*cos(zAlpha)*cos(zBeta) + dq3*cos(q3)^2*cos(zAlpha)*cos(zBeta) - dq2*cos(zAlpha)*cos(zBeta)*sin(q2)^2 - dq3*cos(zAlpha)*cos(zBeta)*sin(q3)^2 - dq1*cos(q2)^2*sin(q1)*sin(zBeta) - dq1*cos(q3)^2*sin(q1)*sin(zBeta) - 2*dq2*cos(q1)*cos(q2)*sin(q2)*sin(zBeta) - 2*dq3*cos(q1)*cos(q3)*sin(q3)*sin(zBeta) - dzAlpha*cos(q2)*cos(zBeta)*sin(q2)*sin(zAlpha) - dzAlpha*cos(q3)*cos(zBeta)*sin(q3)*sin(zAlpha) - dzBeta*cos(q2)*cos(zAlpha)*sin(q2)*sin(zBeta) - dzBeta*cos(q3)*cos(zAlpha)*sin(q3)*sin(zBeta) - 2*dzBeta*cos(q1)*cos(q2)^2*cos(q3)^2*cos(zBeta) - 2*dq2*cos(q2)^2*cos(q3)^2*cos(zAlpha)*cos(zBeta) - 2*dq3*cos(q2)^2*cos(q3)^2*cos(zAlpha)*cos(zBeta) + 2*dq2*cos(q3)^2*cos(zAlpha)*cos(zBeta)*sin(q2)^2 + 2*dq3*cos(q2)^2*cos(zAlpha)*cos(zBeta)*sin(q3)^2 + 2*dq1*cos(q2)^2*cos(q3)^2*sin(q1)*sin(zBeta) + 4*dq2*cos(q1)*cos(q2)*cos(q3)^2*sin(q2)*sin(zBeta) + 2*dq2*cos(q1)*cos(q2)^2*cos(q3)*sin(q3)*sin(zBeta) + 2*dq3*cos(q1)*cos(q2)*cos(q3)^2*sin(q2)*sin(zBeta) + 4*dq3*cos(q1)*cos(q2)^2*cos(q3)*sin(q3)*sin(zBeta) + 2*dzAlpha*cos(q2)*cos(q3)^2*cos(zBeta)*sin(q2)*sin(zAlpha) + 2*dzAlpha*cos(q2)^2*cos(q3)*cos(zBeta)*sin(q3)*sin(zAlpha) + 2*dzBeta*cos(q2)*cos(q3)^2*cos(zAlpha)*sin(q2)*sin(zBeta) + 2*dzBeta*cos(q2)^2*cos(q3)*cos(zAlpha)*sin(q3)*sin(zBeta) - 2*dq2*cos(q1)*cos(q3)*sin(q2)^2*sin(q3)*sin(zBeta) - 2*dq3*cos(q1)*cos(q2)*sin(q2)*sin(q3)^2*sin(zBeta) - 2*dq1*cos(q2)*cos(q3)*sin(q1)*sin(q2)*sin(q3)*sin(zBeta) + 2*dzBeta*cos(q1)*cos(q2)*cos(q3)*cos(zBeta)*sin(q2)*sin(q3) + 4*dq2*cos(q2)*cos(q3)*cos(zAlpha)*cos(zBeta)*sin(q2)*sin(q3) + 4*dq3*cos(q2)*cos(q3)*cos(zAlpha)*cos(zBeta)*sin(q2)*sin(q3)))/(sin(q1 - zAlpha)*sin(q2 + q3)*cos(zBeta)*(cos(q1)*cos(q2)*sin(q3)*sin(zBeta) - cos(q2)*cos(q3)*cos(zAlpha)*cos(zBeta) + cos(q1)*cos(q3)*sin(q2)*sin(zBeta) + cos(zAlpha)*cos(zBeta)*sin(q2)*sin(q3))) - ((cos(q1)*cos(q2)^2*sin(zBeta) + cos(q1)*cos(q3)^2*sin(zBeta) - 2*cos(q1)*cos(q2)^2*cos(q3)^2*sin(zBeta) + cos(q2)*cos(zAlpha)*cos(zBeta)*sin(q2) + cos(q3)*cos(zAlpha)*cos(zBeta)*sin(q3) - 2*cos(q2)*cos(q3)^2*cos(zAlpha)*cos(zBeta)*sin(q2) - 2*cos(q2)^2*cos(q3)*cos(zAlpha)*cos(zBeta)*sin(q3) + 2*cos(q1)*cos(q2)*cos(q3)*sin(q2)*sin(q3)*sin(zBeta))*(dq2*cos(q2)*cos(q3)*sin(zBeta) + dq3*cos(q2)*cos(q3)*sin(zBeta) + dzBeta*cos(q2)*cos(zBeta)*sin(q3) + dzBeta*cos(q3)*cos(zBeta)*sin(q2) - dq2*sin(q2)*sin(q3)*sin(zBeta) - dq3*sin(q2)*sin(q3)*sin(zBeta) - dq1*cos(q1)*cos(q2)*cos(q3)*cos(zBeta)*sin(zAlpha) + dq1*cos(q2)*cos(q3)*cos(zAlpha)*cos(zBeta)*sin(q1) + dq2*cos(q1)*cos(q2)*cos(zAlpha)*cos(zBeta)*sin(q3) + dq2*cos(q1)*cos(q3)*cos(zAlpha)*cos(zBeta)*sin(q2) + dq3*cos(q1)*cos(q2)*cos(zAlpha)*cos(zBeta)*sin(q3) + dq3*cos(q1)*cos(q3)*cos(zAlpha)*cos(zBeta)*sin(q2) + dzAlpha*cos(q1)*cos(q2)*cos(q3)*cos(zBeta)*sin(zAlpha) - dzAlpha*cos(q2)*cos(q3)*cos(zAlpha)*cos(zBeta)*sin(q1) + dzBeta*cos(q1)*cos(q2)*cos(q3)*cos(zAlpha)*sin(zBeta) + dq1*cos(q1)*cos(zBeta)*sin(q2)*sin(q3)*sin(zAlpha) - dq1*cos(zAlpha)*cos(zBeta)*sin(q1)*sin(q2)*sin(q3) + dq2*cos(q2)*cos(zBeta)*sin(q1)*sin(q3)*sin(zAlpha) + dq2*cos(q3)*cos(zBeta)*sin(q1)*sin(q2)*sin(zAlpha) + dq3*cos(q2)*cos(zBeta)*sin(q1)*sin(q3)*sin(zAlpha) + dq3*cos(q3)*cos(zBeta)*sin(q1)*sin(q2)*sin(zAlpha) - dzAlpha*cos(q1)*cos(zBeta)*sin(q2)*sin(q3)*sin(zAlpha) + dzAlpha*cos(zAlpha)*cos(zBeta)*sin(q1)*sin(q2)*sin(q3) - dzBeta*cos(q1)*cos(zAlpha)*sin(q2)*sin(q3)*sin(zBeta) + dzBeta*cos(q2)*cos(q3)*sin(q1)*sin(zAlpha)*sin(zBeta) - dzBeta*sin(q1)*sin(q2)*sin(q3)*sin(zAlpha)*sin(zBeta)))/(sin(q1 - zAlpha)*sin(q2 + q3)*cos(zBeta)*(cos(q1)*cos(q2)*sin(q3)*sin(zBeta) - cos(q2)*cos(q3)*cos(zAlpha)*cos(zBeta) + cos(q1)*cos(q3)*sin(q2)*sin(zBeta) + cos(zAlpha)*cos(zBeta)*sin(q2)*sin(q3))) + (cos(q1 - zAlpha)*(dq1 - dzAlpha)*(cos(q2)*sin(q3)*sin(zBeta) + cos(q3)*sin(q2)*sin(zBeta) - cos(q1)*cos(q2)*cos(q3)*cos(zAlpha)*cos(zBeta) + cos(q1)*cos(zAlpha)*cos(zBeta)*sin(q2)*sin(q3) - cos(q2)*cos(q3)*cos(zBeta)*sin(q1)*sin(zAlpha) + cos(zBeta)*sin(q1)*sin(q2)*sin(q3)*sin(zAlpha))*(cos(q1)*cos(q2)^2*sin(zBeta) + cos(q1)*cos(q3)^2*sin(zBeta) - 2*cos(q1)*cos(q2)^2*cos(q3)^2*sin(zBeta) + cos(q2)*cos(zAlpha)*cos(zBeta)*sin(q2) + cos(q3)*cos(zAlpha)*cos(zBeta)*sin(q3) - 2*cos(q2)*cos(q3)^2*cos(zAlpha)*cos(zBeta)*sin(q2) - 2*cos(q2)^2*cos(q3)*cos(zAlpha)*cos(zBeta)*sin(q3) + 2*cos(q1)*cos(q2)*cos(q3)*sin(q2)*sin(q3)*sin(zBeta)))/(sin(q1 - zAlpha)^2*sin(q2 + q3)*cos(zBeta)*(cos(q1)*cos(q2)*sin(q3)*sin(zBeta) - cos(q2)*cos(q3)*cos(zAlpha)*cos(zBeta) + cos(q1)*cos(q3)*sin(q2)*sin(zBeta) + cos(zAlpha)*cos(zBeta)*sin(q2)*sin(q3))) + (cos(q2 + q3)*(dq2 + dq3)*(cos(q2)*sin(q3)*sin(zBeta) + cos(q3)*sin(q2)*sin(zBeta) - cos(q1)*cos(q2)*cos(q3)*cos(zAlpha)*cos(zBeta) + cos(q1)*cos(zAlpha)*cos(zBeta)*sin(q2)*sin(q3) - cos(q2)*cos(q3)*cos(zBeta)*sin(q1)*sin(zAlpha) + cos(zBeta)*sin(q1)*sin(q2)*sin(q3)*sin(zAlpha))*(cos(q1)*cos(q2)^2*sin(zBeta) + cos(q1)*cos(q3)^2*sin(zBeta) - 2*cos(q1)*cos(q2)^2*cos(q3)^2*sin(zBeta) + cos(q2)*cos(zAlpha)*cos(zBeta)*sin(q2) + cos(q3)*cos(zAlpha)*cos(zBeta)*sin(q3) - 2*cos(q2)*cos(q3)^2*cos(zAlpha)*cos(zBeta)*sin(q2) - 2*cos(q2)^2*cos(q3)*cos(zAlpha)*cos(zBeta)*sin(q3) + 2*cos(q1)*cos(q2)*cos(q3)*sin(q2)*sin(q3)*sin(zBeta)))/(sin(q1 - zAlpha)*sin(q2 + q3)^2*cos(zBeta)*(cos(q1)*cos(q2)*sin(q3)*sin(zBeta) - cos(q2)*cos(q3)*cos(zAlpha)*cos(zBeta) + cos(q1)*cos(q3)*sin(q2)*sin(zBeta) + cos(zAlpha)*cos(zBeta)*sin(q2)*sin(q3))) - (dzBeta*sin(zBeta)*(cos(q2)*sin(q3)*sin(zBeta) + cos(q3)*sin(q2)*sin(zBeta) - cos(q1)*cos(q2)*cos(q3)*cos(zAlpha)*cos(zBeta) + cos(q1)*cos(zAlpha)*cos(zBeta)*sin(q2)*sin(q3) - cos(q2)*cos(q3)*cos(zBeta)*sin(q1)*sin(zAlpha) + cos(zBeta)*sin(q1)*sin(q2)*sin(q3)*sin(zAlpha))*(cos(q1)*cos(q2)^2*sin(zBeta) + cos(q1)*cos(q3)^2*sin(zBeta) - 2*cos(q1)*cos(q2)^2*cos(q3)^2*sin(zBeta) + cos(q2)*cos(zAlpha)*cos(zBeta)*sin(q2) + cos(q3)*cos(zAlpha)*cos(zBeta)*sin(q3) - 2*cos(q2)*cos(q3)^2*cos(zAlpha)*cos(zBeta)*sin(q2) - 2*cos(q2)^2*cos(q3)*cos(zAlpha)*cos(zBeta)*sin(q3) + 2*cos(q1)*cos(q2)*cos(q3)*sin(q2)*sin(q3)*sin(zBeta)))/(sin(q1 - zAlpha)*sin(q2 + q3)*cos(zBeta)^2*(cos(q1)*cos(q2)*sin(q3)*sin(zBeta) - cos(q2)*cos(q3)*cos(zAlpha)*cos(zBeta) + cos(q1)*cos(q3)*sin(q2)*sin(zBeta) + cos(zAlpha)*cos(zBeta)*sin(q2)*sin(q3)));
if isnan(da17); da17=0; end
dq4=da17*(cos(q4))^2;
da18=(sin(q1 - q2 - q3 - zAlpha)*(dq2 - dq1 + dq3 + dzAlpha) + sin(q1 + q2 + q3 - zAlpha)*(dq1 + dq2 + dq3 - dzAlpha))/(2*cos(zAlpha)*((cos(q1 - zAlpha)*cos(q4))/cos(zAlpha) - (sin(q4)*(sin(q1 - q2 - q3 - zAlpha) + sin(q1 + q2 + q3 - zAlpha)))/(2*cos(zAlpha)))) + ((cos(q1 - q2 - q3 - zAlpha) - cos(q1 + q2 + q3 - zAlpha))*((sin(q1 - zAlpha)*cos(q4)*(dq1 - dzAlpha))/cos(zAlpha) - (sin(q4)*(cos(q1 - q2 - q3 - zAlpha)*(dq2 - dq1 + dq3 + dzAlpha) - cos(q1 + q2 + q3 - zAlpha)*(dq1 + dq2 + dq3 - dzAlpha)))/(2*cos(zAlpha)) + (dq4*cos(q4)*(sin(q1 - q2 - q3 - zAlpha) + sin(q1 + q2 + q3 - zAlpha)))/(2*cos(zAlpha)) + (dq4*cos(q1 - zAlpha)*sin(q4))/cos(zAlpha) - (dzAlpha*cos(q1 - zAlpha)*cos(q4)*sin(zAlpha))/cos(zAlpha)^2 + (dzAlpha*sin(q4)*sin(zAlpha)*(sin(q1 - q2 - q3 - zAlpha) + sin(q1 + q2 + q3 - zAlpha)))/(2*cos(zAlpha)^2)))/(2*cos(zAlpha)*((cos(q1 - zAlpha)*cos(q4))/cos(zAlpha) - (sin(q4)*(sin(q1 - q2 - q3 - zAlpha) + sin(q1 + q2 + q3 - zAlpha)))/(2*cos(zAlpha)))^2) + (dzAlpha*sin(zAlpha)*(cos(q1 - q2 - q3 - zAlpha) - cos(q1 + q2 + q3 - zAlpha)))/(2*cos(zAlpha)^2*((cos(q1 - zAlpha)*cos(q4))/cos(zAlpha) - (sin(q4)*(sin(q1 - q2 - q3 - zAlpha) + sin(q1 + q2 + q3 - zAlpha)))/(2*cos(zAlpha))));
dq5=da18*(cos(q5))^2;
